<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Local Community Event Portal</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 0 1em;
      background: #f9f9f9;
      color: #333;
    }
    nav {
      background-color: #004080;
      padding: 1em;
      margin-bottom: 1em;
    }
    nav a {
      color: white;
      margin-right: 1.5em;
      text-decoration: none;
      font-weight: bold;
    }
    nav a:hover {
      text-decoration: underline;
    }
    #welcomeBanner {
      background-color: #0074d9;
      color: white;
      padding: 1em;
      margin-bottom: 1em;
      border-radius: 5px;
    }
    .highlight {
      background-color: #fffa8b;
      font-weight: bold;
      padding: 0 0.3em;
      border-radius: 3px;
    }
    table {
      border-collapse: collapse;
      width: 100%;
      max-width: 700px;
      margin-bottom: 2em;
    }
    th, td {
      padding: 0.5em;
      text-align: center;
      border: 1px solid #ddd;
    }
    .imgBorder {
      border: 2px solid #0074d9;
      border-radius: 5px;
      width: 100px;
      height: auto;
    }
    caption {
      font-weight: bold;
      margin-bottom: 0.5em;
      text-align: left;
    }
    form {
      max-width: 500px;
      background: white;
      padding: 1em;
      border-radius: 5px;
      margin-bottom: 2em;
      box-shadow: 0 0 5px #ccc;
    }
    label {
      display: block;
      margin: 0.5em 0 0.2em;
    }
    input, select, textarea, button {
      width: 100%;
      padding: 0.5em;
      margin-bottom: 1em;
      border-radius: 4px;
      border: 1px solid #ccc;
      box-sizing: border-box;
      font-size: 1em;
    }
    #submitFeedback, #clearPrefs, #findEventsBtn {
      width: auto;
      cursor: pointer;
      background-color: #0074d9;
      color: white;
      border: none;
      font-weight: bold;
      padding: 0.7em 1.2em;
      border-radius: 5px;
    }
    #submitFeedback:hover, #clearPrefs:hover, #findEventsBtn:hover {
      background-color: #005fa3;
    }
    #feedbackConfirmation, #videoStatus, #locationStatus {
      font-weight: bold;
      margin-top: 0.5em;
    }
    #promoVideo {
      max-width: 100%;
      border-radius: 5px;
      margin-bottom: 1em;
    }
    #eventImage {
      cursor: pointer;
      width: 200px;
      border-radius: 5px;
      transition: width 0.3s ease;
    }
  </style>
</head>
<body>
  <!-- Navigation -->
  <nav>
    <a href="#home">Home</a>
    <a href="#events">Events</a>
    <a href="#contact">Contact</a>
    <a href="help.html" target="_blank">Help</a>
  </nav>
  <!-- Main -->
  <main>
    <!-- Welcome Banner -->
    <div id="welcomeBanner">
      Welcome back, <span class="highlight">Resident!</span> 
      Check out our <span style="color: red; font-weight: bold;">special offer</span> for early registrations.
    </div>

    <!-- Home Section -->
    <section id="home">
      <h1>Welcome to the community events Portal</h1>
      <p>Use the navigation above to browse events and services.</p>
    </section>

    <!-- Events Section -->
    <section id="events">
      <h2>Gallery of Community Events</h2>
      <table>
        <caption>Highlights of past events</caption>
        <tbody>
          <tr>
            <td><img src="event1.jpg" alt="Spring Festival" title="Spring Festival" class="imgBorder" /><br>Spring Festival</td>
            <td><img src="event2.jpg" alt="Music Concert" title="Music Concert" class="imgBorder" /><br>Music Concert</td>
            <td><img src="event3.jpg" alt="Art Workshop" title="Art Workshop" class="imgBorder" /><br>Art Workshop</td>
          </tr>
          <tr>
            <td><img src="event4.jpg" alt="Food Fair" title="Food Fair" class="imgBorder" /><br>Food Fair</td>
            <td><img src="event5.jpg" alt="Charity Run" title="Charity Run" class="imgBorder" /><br>Charity Run</td>
            <td><img src="event6.jpg" alt="Tech Meetup" title="Tech Meetup" class="imgBorder" /><br>Tech Meetup</td>
          </tr>
        </tbody>
      </table>
      <!-- Event Registration Form -->
      <h2>Register for an Event</h2>
      <form id="eventForm">
        <label for="name">Name:</label>
        <input type="text" id="name" name="name" placeholder="Your full name" required autofocus />

        <label for="email">Email:</label>
        <input type="email" id="email" name="email" placeholder="you@example.com" required />

        <label for="date">Date:</label>
        <input type="date" id="date" name="date" required />

        <label for="eventType">Event Type:</label>
        <select id="eventType" name="eventType" required>
          <option value="" disabled selected>Select the event type</option>
          <option value="festival">Festival</option>
          <option value="concert">Concert</option>
          <option value="workshop">Workshop</option>
          <option value="meetup">Meetup</option>
        </select>

        <label for="message">Message:</label>
        <textarea id="message" name="message" placeholder="Any special requirements or comments..."></textarea>

        <button type="submit">Submit Registration</button>
        <output id="formOutput" style="font-weight:bold; margin-top: 1em; display:block;"></output>
      </form>

      <!-- Clear Preferences Button for Task 8 -->
      <button type="button" id="clearPrefs">Clear Preferences</button>

    </section>

    <!-- Feedback Section -->
    <section id="feedback">
      <h2>Event Feedback</h2>

      <form id="feedbackForm">
        <label for="phone">Phone Number:</label>
        <input type="tel" id="phone" name="phone" placeholder="e.g. 123-456-7890" required />

        <label for="eventSelect">Select Event:</label>
        <select id="eventSelect" name="eventSelect" required>
          <option value="" disabled selected>Select an event</option>
          <option value="festival" fee="50">Festival</option>
          <option value="concert" fee="40">Concert</option>
          <option value="workshop" fee="30">Workshop</option>
          <option value="meetup" fee="0">Meetup(Free)</option>
        </select>
        <p id="eventFee"></p>

        <label for="feedbackText">Your Feedback:</label>
        <textarea id="feedbackText" name="feedbackText" rows="4" placeholder="Type your feedback here..."></textarea>
        <small>Characters typed: <span id="charCount">0</span></small><br />

        <button type="button" id="submitFeedback">Submit Feedback</button>
      </form>

      <p id="feedbackConfirmation"></p>

      <h3>Event Highlight</h3>
      <img
        id="eventImage"
        src="event-highlight.jpg"
        alt="Event Highlight"
        title="Double-click to enlarge"
      />
    </section>

    <!-- Video Invite Section -->
    <section id="videoInvite">
      <h2>Event Promo Video</h2>
      <video id="promoVideo" width="480" controls oncanplay="videoReady()">
        <source src="event-promo.mp4" type="video/mp4" />
        Your browser does not support the video tag.
      </video>
      <p id="videoStatus"></p>
    </section>

    <!-- Geolocation Section -->
    <section id="geoLocation">
      <h2>Find Nearby Events</h2>
      <button id="findEventsBtn">Find Nearby Events</button>
      <p id="locationStatus"></p>
    </section>

    <!-- Contact Section -->
    <section id="contact">
      <h2>Contact Us</h2>
      <p>For questions or support, email us at <a href="mailto:support@cityevents.gov">support@cityevents.gov</a></p>
    </section>

  </main>
  <!-- Footer -->
  <footer>
    <p>Â© 2025 Community Council. All rights reserved.</p>
  </footer>
  <!-- JavaScript -->
  <script>
    // Task 5: Registration form submit handler with confirmation output
    const eventForm = document.getElementById("eventForm");
    const formOutput = document.getElementById("formOutput");
    eventForm.addEventListener("submit", (e) => {
      e.preventDefault();
      formOutput.textContent = `Thank you, ${eventForm.name.value.trim()}, for registering for the ${eventForm.eventType.value} event on ${eventForm.date.value}.`;
      eventForm.reset();
      localStorage.removeItem("preferredEventType"); // Optionally clear saved pref on submit
      sessionStorage.removeItem("preferredEventTypeSession");
    });
    // Task 6: Feedback event handlers
    const phoneInput = document.getElementById("phone");
    phoneInput.onblur = function () {
      const phonePattern = /^\d{3}[-.\s]?\d{3}[-.\s]?\d{4}$/;
      if (!phonePattern.test(this.value.trim())) {
        alert("Please enter a valid phone number (e.g., 123-456-7890).");
        this.focus();
      }
    };
    const eventSelect = document.getElementById("eventSelect");
    const eventFeeDisplay = document.getElementById("eventFee");
    eventSelect.onchange = function () {
      const selectedOption = this.options[this.selectedIndex];
      const fee = selectedOption.getAttribute("fee");
      eventFeeDisplay.textContent =
        fee == 0 ? "This event is free!" : `Event Fee: $${fee}`;
    };
    const submitBtn = document.getElementById("submitFeedback");
    const feedbackConfirmation = document.getElementById("feedbackConfirmation");
    submitBtn.onclick = function () {
      const phone = phoneInput.value.trim();
      const eventName = eventSelect.options[eventSelect.selectedIndex]?.text || "an event";
      if (!phone || !eventSelect.value) {
        alert("Please fill in your phone number and select an event before submitting.");
        return;
      }
      feedbackConfirmation.textContent = `Thank you for your feedback about the ${eventName}!`;
    };
    const eventImage = document.getElementById("eventImage");
    let enlarged = false;
    eventImage.ondblclick = function () {
      if (!enlarged) {
        this.style.width = "400px";
        enlarged = true;
      } else {
        this.style.width = "200px";
        enlarged = false;
      }
    };
    const feedbackText = document.getElementById("feedbackText");
    const charCount = document.getElementById("charCount");
    feedbackText.addEventListener("input", function () {
      charCount.textContent = this.value.length;
    });
    // Task 7
    const promoVideo = document.getElementById("promoVideo");
    const videoStatus = document.getElementById("videoStatus");
    function videoReady() {
      videoStatus.textContent = "Video ready to play.";
    }
    window.onbeforeunload = function (e) {
      if (
        eventForm.name.value ||
        eventForm.email.value ||
        eventForm.date.value ||
        eventForm.eventType.value
      ) {
        e.preventDefault();
        e.returnValue =
          "You have unsaved changes. Are you sure you want to leave?";
      }
    };

    // Task 8
    const eventTypeSelect = document.getElementById("eventType");
    const clearPrefsBtn = document.getElementById("clearPrefs");
    window.addEventListener("load", () => {
      const savedPref = localStorage.getItem("preferredEventType");
      if (savedPref) {
        eventTypeSelect.value = savedPref;
      }
    });
    eventTypeSelect.addEventListener("change", () => {
      localStorage.setItem("preferredEventType", eventTypeSelect.value);
      sessionStorage.setItem("preferredEventTypeSession", eventTypeSelect.value);
    });

    clearPrefsBtn.addEventListener("click", () => {
      localStorage.clear();
      sessionStorage.clear();
      eventTypeSelect.value = "";
      alert("Preferences cleared.");
    });
    const findEventsBtn = document.getElementById("findEventsBtn");
    const locationStatus = document.getElementById("locationStatus");
    findEventsBtn.addEventListener("click", () => {
      if (!navigator.geolocation) {
        locationStatus.textContent = "Geolocation is not supported by your browser.";
        return;
      }
      locationStatus.textContent = "Locating...";

      const options = {
        enableHighAccuracy: true,
        timeout: 10000,
        maximumAge: 0,
      };
      function success(position) {
        const lat = position.coords.latitude.toFixed(5);
        const lon = position.coords.longitude.toFixed(5);
        locationStatus.textContent = `Your coordinates: Latitude ${lat}, Longitude ${lon}`;
        // Here you can add logic to find nearby events using coordinates
      }
      function error(err) {
        if (err.code === err.PERMISSION_DENIED) {
          locationStatus.textContent = "Permission denied. Cannot access location.";
        } else if (err.code === err.TIMEOUT) {
          locationStatus.textContent = "Location request timed out.";
        } else {
          locationStatus.textContent = "Error getting location: " + err.message;
        }
      }
      navigator.geolocation.getCurrentPosition(success, error, options);
    });
    console.log("Page loaded -The Community Event Portal");
  </script>
</body>
</html>
